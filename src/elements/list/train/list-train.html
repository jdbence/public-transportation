<link rel="import" href="/bower_components/polymer/polymer.html">
<link rel="import" href="/bower_components/paper-item/paper-item.html">
<link rel="import" href="/bower_components/paper-item/paper-item-body.html">
<link rel="import" href="/bower_components/paper-listbox/paper-listbox.html">

<dom-module id="list-train">
  <style is="custom-style">
    .trip-header {
      position: relative;
      font-size: 0.8em;
    }
    .duration {
      position: absolute;
      right: 0;
      top: 0;
    }
    .station {
      background-color: red;
      color: white;
      padding: 0.5em;
    }
    paper-item {
      border-bottom: 1px solid #ddd;
    }
    paper-item-body {
      position: relative;
    }
  </style>
  
  <template>
    <paper-listbox>
      <template is="dom-repeat" items="{{list}}" as="trip">
        <paper-item>
          
          <paper-item-body>
            <div class='trip-header'>
              <span>
                #{{trip.trip_id}}
              </span>
              <span class='duration'>
                {{_tripDuration(trip)}} min
              </span>
            </div>
            <div>
              <span>{{_tripSchedule(trip)}}</span>
            </div>
          </paper-item-body>
        </paper-item>
      </template>
    </paper-listbox>
  </template>
  
  <script>
    Polymer({
      is: 'list-train',
      properties: {
         list: {
          type: Array,
          value: function() {
            return [];
          },
          notify: true
        }
      },
      _getTime: function(time) {
        if(time.indexOf('25:') === 0){
          time = time.split('25:').join('01:');
          return new Date("2016/01/02 " + time).getTime();
        }else if(time.indexOf('24:') === 0){
          time = time.split('24:').join('00:');
          return new Date("2016/01/02 " + time).getTime();
        }
        return new Date("2016/01/01 " + time).getTime();
      },
      _getStandardTime: function(time) {
        time = time.split(':');
        var hr = Number(time[0]);
        var min = Number(time[1]);
        var val = '' + (hr > 12 ? hr - 12 : hr);
        val += min < 10 ? ':0' + min : ':' + min;
        val += hr < 12 ? 'am' : 'pm';
        return val;
      },
      _tripSchedule: function (trip) {
        return this._getStandardTime(trip.departure_time) + ' - ' + this._getStandardTime(trip.arrival_time);
      },
      _tripDuration: function(trip) {
        var diff = Math.abs(this._getTime(trip.arrival_time) - this._getTime(trip.departure_time));
        return Math.round(diff / 60000);
      }
    });
  </script>
</dom-module>